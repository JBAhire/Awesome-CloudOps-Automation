name: Make Release

on:
  workflow_dispatch: 
    inputs:
      release_tag:
        description: "Release Tag"
        required: true
        type: string
  
jobs:
  # build-docker: 
  #   uses: "./.github/workflows/build-and-release-docker.yml"
  #   with:
  #     enabled: true
  #     release_tag: "${{ inputs.release_tag }}"
  #     build_number: "${{ inputs.release_tag }}"
  #     elyra_branch: "master"
  #     unskript_branch: "master"
  #     celltoolbar_branch: "master"
  #     snippet_branch: "master"
  #   secrets: inherit

  make-release:
    runs-on: ubuntu-latest
    #needs: ["build-docker"]
    steps:
      - uses: actions/checkout@v3
      - run: git fetch --prune --unshallow
      - name: Bump version and push tag
        id: tag_version
        uses: mathieudutour/github-tag-action@v6.1
        with:
          github_token: ${{ secrets.BUILDER_PAT }}
          dry_run: true
          default_bump: minor
          default_prerelease_bump: minor
          tag_prefix: " "
        env:
          TAG: echo "`echo ${{ steps.tag_version.outputs.new_tag }} | cut -d'-' -f 1`"
      - name: Create a GitHub release
        uses: ncipollo/release-action@v1

        with:
          tag: ${{ steps.tag_version.outputs.new_tag }}
          name: Release ${{ steps.tag_version.outputs.new_tag }}
          body: ${{ steps.tag_version.outputs.changelog }}